(()=>{var t={162:function(t,e,n){var o,i,a;i=[],o=function(){"use strict";function e(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function o(t,e,n){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){c(o.response,e,n)},o.onerror=function(){console.error("could not download file")},o.send()}function i(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function a(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,r=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(t,e,n){var r=s.URL||s.webkitURL,c=document.createElement("a");e=e||t.name||"download",c.download=e,c.rel="noopener","string"==typeof t?(c.href=t,c.origin===location.origin?a(c):i(c.href)?o(t,e,n):a(c,c.target="_blank")):(c.href=r.createObjectURL(t),setTimeout((function(){r.revokeObjectURL(c.href)}),4e4),setTimeout((function(){a(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,n,s){if(n=n||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,s),n);else if(i(t))o(t,n,s);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout((function(){a(r)}))}}:function(t,e,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return o(t,e,n);var a="application/octet-stream"===t.type,c=/constructor/i.test(s.HTMLElement)||s.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||a&&c||r)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var t=l.result;t=h?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=t:location=t,i=null},l.readAsDataURL(t)}else{var d=s.URL||s.webkitURL,u=d.createObjectURL(t);i?i.location=u:location.href=u,i=null,setTimeout((function(){d.revokeObjectURL(u)}),4e4)}});s.saveAs=c.saveAs=c,t.exports=c},void 0===(a="function"==typeof o?o.apply(e,i):o)||(t.exports=a)}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";function t(t,e,n){const o=document.createElement("canvas");return o.width=t,o.height=e,n&&o.getContext("2d").putImageData(n,0,0),o}function e(e,n,o,i,a){return t(i,a,e.getContext("2d").getImageData(n,o,i,a))}const o=["","Amazone","Construction","Antartica","Vegas","Circus"];async function i(t){return new Promise((e=>{const n=setInterval((()=>{t()&&(e(),clearInterval(n))}),200)}))}var a=n(162);const s=16,r=16;let c=!1;const h=[],l=[],d=new Map,u=[];let f;async function p(e){const n=document.createElement("img");n.src=`./assets/${e}.png`,await i((()=>n.complete));const o=t(n.width,n.height);return o.getContext("2d").drawImage(n,0,0),o}async function v(e){const n=await p(`sheet_${e}`),o=n.getContext("2d"),i=new Map;for(let e=0;e<6;e++)for(let n=0;n<27;n++){const a=48+36*e+n,c=e*s,h=n*r,l=o.getImageData(c,h,s,r),d=t(s,r,l);i.set(a,d)}return[n,i]}(async()=>{for(let t=1;t<=5;t++)[h[t],l[t]]=await v(t),u[t]=await p(`background_${t}`);f=await p("unknown_tile"),await async function(){const t=await p("font_tiny");for(let n=0;n<16;n++)d.set(n.toString(16),e(t,3*n,0,3,5));d.set("?",e(t,48,0,3,5))}(),c=!0})();const m=50;document.body.style.margin="0",document.documentElement.style.backgroundColor="#333";const g=document.createElement("canvas");document.body.appendChild(g);const w=document.createElement("div");document.body.appendChild(w);const y=new class{canvas;info;selectedTile=48;hoverX=0;hoverY=0;dragging=!1;fileName="map.pak";dataHeader=new Uint8Array([48,48,32]);mapData=new Uint8Array(1800);episode=1;context;constructor(t,e){this.canvas=t,this.info=e,this.canvas.width=896,this.canvas.height=600,this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",this.mouseMove.bind(this)),this.canvas.addEventListener("mousedown",(()=>this.dragging=!0)),this.canvas.addEventListener("mouseup",(()=>this.dragging=!1)),this.canvas.addEventListener("mouseleave",(()=>this.dragging=!1)),this.canvas.addEventListener("click",(()=>{this.hoverX<6&&this.hoverY<27?this.selectedTile=48+36*this.hoverX+this.hoverY:this.hoverX>=6&&(this.mapData[this.hoverX-6+this.hoverY*m]=this.selectedTile)})),this.mapData.fill(48),i((()=>c)).then(this.redraw.bind(this)),e.style.position="absolute",e.style.marginTop="-26px",e.style.left="100px"}setEpisode(t){this.episode=t,this.redraw()}async importFile(t){this.fileName=t.name;const e=await async function(t){let e,n=!1;const o=new FileReader;return o.onload=()=>{o.result?e=new Uint8Array(o.result):(alert("invalid file"),n=!0)},o.readAsArrayBuffer(t),await i((()=>!!e||n)),e}(t);e&&(this.mapData.set(e.slice(3)),this.dataHeader.set(e.slice(0,3))),this.redraw()}exportFile(){const t=new Uint8Array(this.dataHeader.length+this.mapData.length);t.set(this.dataHeader),t.set(this.mapData,3),async function(t,e){const n=new Blob([t],{type:"octet/stream"});(0,a.saveAs)(n,e)}(t,this.fileName)}mouseMove(t){const e=this.hoverX,n=this.hoverY;this.hoverX=Math.floor(t.clientX/s),this.hoverY=Math.floor(t.clientY/r),e===this.hoverX&&n===this.hoverY||this.redraw(),this.dragging&&this.hoverX>=6&&(this.mapData[this.hoverX-6+this.hoverY*m]=this.selectedTile)}drawSelector(){this.context.save(),this.context.fillStyle="#222",this.context.fillRect(0,0,96,600),this.context.restore(),this.context.drawImage(h[this.episode],0,0);const t=Math.floor((this.selectedTile-48)/36),e=(this.selectedTile-48)%36;this.context.save(),this.context.strokeStyle="#ffffffff",this.context.strokeRect(t*s,e*r,s,r),this.context.restore()}drawMap(){const t=u[this.episode];if(!t)return;this.context.drawImage(t,96,0);const e=l[this.episode];for(let t=0;t<36;t++)for(let n=0;n<m;n++){const o=this.hoverX-6===n&&this.hoverY===t?this.selectedTile:this.mapData[t*m+n],i=e.get(o||48)||f;this.context.drawImage(i,(6+n)*s,t*r)}}drawHover(){this.hoverX<0||this.hoverX>=56||this.hoverY<0||this.hoverY>=36||(this.context.save(),this.context.fillStyle="#ffffff3f",this.context.fillRect(this.hoverX*s,this.hoverY*r,s,r),this.context.restore())}setInfo(){this.info.innerHTML=`<b>Hover:&nbsp;</b><span>X: ${Math.max(0,this.hoverX-6)}, Y: ${Math.min(this.hoverY,36)}, Tile: ${this.mapData[this.hoverX-6+this.hoverY*m]?.toString(16).padStart(2,"0")}</span>`}redraw(){this.context.clearRect(0,0,896,600),this.drawMap(),this.drawSelector(),this.drawHover(),this.setInfo()}}(g,w),x=document.createElement("div");document.body.appendChild(x);const b=document.createElement("select");for(let t=1;t<=5;t++){const e=document.createElement("option");e.textContent=`${t} - ${o[t]}`,b.appendChild(e)}b.onchange=function(){y.setEpisode(b.selectedIndex+1)},x.appendChild(b);const E=document.createElement("button");E.textContent="import",E.onclick=function(){const t=document.createElement("input");t.type="file",t.accept=".pak",t.click(),t.onchange=async function(){const e=t.files&&t.files[0];e&&y.importFile(e)}},x.appendChild(E);const T=document.createElement("button");T.textContent="export",T.onclick=()=>y.exportFile(),x.appendChild(T)})()})();